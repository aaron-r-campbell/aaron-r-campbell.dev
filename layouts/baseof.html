<!doctype html>
<html lang="{{ .Site.LanguageCode }}">
  <head>
    {{ partial "head.html" . }}
  </head>
  <body>
    <header>{{ partial "header.html" . }}</header>
    <main>
      <div style="z-index: 10;position: absolute; top: 0; right: 0; margin: var(--spacer)">
        <input class="hidden" id="darkMode" type="checkbox" />
        <label class="hidden" for="darkMode" tabindex="3">
          <span id="theme-icon-sun" hidden>
            <svg
              role="img"
              width="2em"
              height="2em"
              viewBox="0 0 100 100"
              xmlns="http://www.w3.org/2000/svg"
            >
              <defs>
                <mask id="sun-mask">
                  <image
                    href="{{ "icons8/icons8-sun-90.png" | relURL }}"
                    width="100"
                    height="100"
                  />
                </mask>
              </defs>
              <rect
                width="100"
                height="100"
                fill="currentColor"
                mask="url(#sun-mask)"
              />
            </svg>
          </span>
          <span id="theme-icon-moon" hidden>
            <svg
              role="img"
              width="2em"
              height="2em"
              viewBox="0 0 100 100"
              xmlns="http://www.w3.org/2000/svg"
            >
              <defs>
                <mask id="moon-mask">
                  <image
                    href="{{ "icons8/icons8-moon-90.png" | relURL }}"
                    width="100"
                    height="100"
                  />
                </mask>
              </defs>
              <rect
                width="100"
                height="100"
                fill="currentColor"
                mask="url(#moon-mask)"
              />
            </svg>
          </span>
        </label>
      </div>
      <script>
        (() => {
          const mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
          const stored = localStorage.getItem("colorscheme");
          const input = document.getElementById("darkMode");
          const label = document.querySelector('label[for="darkMode"]');
          const sunIcon = document.getElementById("theme-icon-sun");
          const moonIcon = document.getElementById("theme-icon-moon");
          if (!input || !label) return;

          const setColorScheme = (dark) => {
            input.checked = dark;
            sunIcon.hidden = dark ? false : true;
            moonIcon.hidden = dark ? true : false;
            document.documentElement.classList.toggle("dark", dark);
            document.documentElement.classList.toggle("light", !dark);
          };

          input.addEventListener("change", () => {
            localStorage.setItem(
              "colorscheme",
              input.checked ? "dark" : "light",
            );
            setColorScheme(input.checked);
          });
          mediaQuery.addEventListener("change", () => {
            const stored = localStorage.getItem("colorscheme");
            setColorScheme(stored ? stored == "dark" : mediaQuery.matches);
          });

          setColorScheme(stored ? stored === "dark" : mediaQuery.matches);
          label.classList.toggle("hidden", false);
        })();
      </script>

      {{ block "main" . }}{{ end }}
    </main>
    <footer>{{ partial "footer.html" . }}</footer>
  </body>
</html>
